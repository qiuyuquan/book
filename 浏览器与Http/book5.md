# http相关知识

## http/1.x的缺陷
* **连接无法复用**：连接无法复用会导致每次请求会经历三次握手和慢启动，而三次握手在搞延迟的场景下影响较大
 1. http/1.0传输数据时，每次都要重新建立连接，增加延迟
 2. http/1.1 虽然加入了keep-alive可以复用一部分连接，但域名分片的情况下任需建立多个连接，耗费资源

* **对头阻塞**：同一个域名下同时发起http请求不能超过6个，超过则需要等待其他资源完成后，才能发起请求。
  1. http/1.0传输数据时，下个请求必须在前一个请求返回后才能发出
  2. http/1.1可以一次发出多个请求，但是要求返回是按序的，如果前一个请求如果很耗时的话，那么即使后面的请求已处理完成，也回等到前面的处理完成才开始返回。

* **协议开销大**：在http1.x中，header携带的内容过大，在一定程度上增加了传输成本，并且每次请求header基本不怎么变化。

* **安全因素**：http1.x传输数据时，传输的内容都是明文，客户端和服务端都无法验证对方身份。

## SPDY协议
因为http1.x的问题，谷歌推出SPDY，降低延迟，压缩header等，为http/2带来前景。

# http/2简介
新特性
* **1. 二进制传输**
http/1.x采用的文本传输，而http/2采用二进制格式传输数据，解析起来更搞笑。
http/2将请求和响应数据分割为更小的帧，并且他们采用二进制编码

* **2. 多路复用**
多路复用解决了浏览器限制统一域名下的请求数量的问题。同一个域名只需要占用一个tcp连接，使用一个连接可以并行发送多个请求和响应，解决多个tcp连接带来的延时和内存消耗。

* **3. header压缩**
在http/1中，我们使用文本传输header，在header传输cookie的情况下，可能每次需要重复传输几百到几千的字节。因此http/2对这些首部采取了压缩策略。

在客户端和服务端建立首部表来跟踪和对应每次发送的键值对，对应相同的数据，不在通过每次请求和响应发送。（就是双方建立起一个对应表，发送和响应时，判断是否对应表中是否有对应的字段，有的话就不发送了）

# 什么是https
https是一种通过计算机网络进行安全通信的传输协议，经http进行通信，利用ssl/tls简历安全信道，加密数据包。

https使用的目的是提供对网站服务器的身份认证，同时保护互换数据的隐私和完整性。

## https 诞生
由于http的缺点：
1. 通信使用明文
2. 不验证通信方身份
3. 无法验证报文的完整性
为了解决这几个问题，所以https就此诞生
```
https = http+加密(混合加密)+认证(证书认证)+完整性认证(防止内容被篡改)
```
对于加密，认证和完整性认证，tcp/ip提供了一个用于数据安全传输的协议ssl，也就是
```
https = http + ssl协议
```

**ssl协议**
1. 交换双方的协商加密算法以及传输各自生成的随机数(为后续生成master secret准备)
2. 服务端将自己的证书发给客户端，证书包含一个数字签名(CA证书)和CA证书的公钥。
3. 客户端对证书包含的服务端信息进行hash，同时用接收到的服务到公钥对数字证书解密，获取其中的hash值，与前面计算到的hash进行比较，验证证书的有效性。
4. 服务端接着发送server hello done，表示最初的协商握手过程结束；
5. 客户端受到握手结束的消息后，根据报文中，包含通信加密pre-master secret的随机密码串，用接收到的公钥进行加密，发送change cipher spec报文，告诉服务端以后都用master secet进行加密。（非对称加密）
6. 服务端收到change cipher spec报文后，同样是change cipher spec回复
7. 服务端发送finish给客户端，告知ssl握手的过程结束。
8. 此后使用http协议使用master secret加密过的数据(使用对称加密)。

**对称加密**
加密和解密都使用同样的秘钥，比如上面的第8步生成的master secret

**非对称加密**
公钥加密，私钥解密，比如上面的第5步，客户端使用服务端的公钥加密，服务端接收后使用私钥解密

简单点来说就是
1. 客户端向服务端索要并验证公钥。这一阶段使用非对称加密，服务端将数字证书发送给客户端，其中数字证书包含：公钥和数字前面。客户端在拿到后对两者进行校验
2. 在非对称加密传输中，两端协商生成对话秘钥
3. 双方采用对话秘钥进行对称加密通信

## http与https的区别
* http是明文传输，https通过ssl/tls进行了加密
* http的端口号是88，https是443
* https需要申请ca证书
* http的连接是简单，无状态的。而https是有ssl+http协议进行加密传输，身份认证的网络协议，比http协议安全

## https的缺点
* https协议握手阶段比较费时
* ssl证书需要申请和钱

## 为什么要用https
* 保证数据传输的安全
* 确认网站真实，防止钓鱼网站

[HTTPS详解](https://juejin.im/post/6844903602494898183)
[谈谈 HTTPS](https://juejin.im/post/6844903504046211079)
[一文读懂 HTTP/2 及 HTTP/3 特性](https://blog.fundebug.com/2019/03/07/understand-http2-and-http3/)