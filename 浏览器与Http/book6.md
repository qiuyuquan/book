# cdn
## 为什么需要cdn
解决http传输时丢包，慢启动，拥堵的问题。由于cdn内部对tcp的优化，对静态资源的缓存、预取，加上用户访问cdn时，会被智能分配到最近的节点，降低大量延迟，让访问速度可以得到很大的提升。

## cdn原理
cdn的基本原理是广泛采用各种缓存服务器，将这些服务器分布到用户访问相对集中的地区或网络中，在用户访问网站时，利用全局负载均衡将用户的访问指向距离最近的缓存服务器中，有缓存服务器直接响应。

**负载均衡**
cdn负载均衡会为用户选择一台合适的服务器提供服务。选择的依据包括
1. 根据用户ip地址，判断那一台服务器距离用户最近。
2. 根据用户所请求的url中携带的内容名称，判断那一台服务器上有所需内容。
3. 查询各个服务器的负载情况，判断哪一台服务器的负载较小。

**缓存**
缓存服务器响应用户信息，将用户所需内容返回给用户，如果这个服务器上没有内容，负载均衡依然分配给了用户，name这台服务器就需要向它的上一级缓存服务器请求内容，直至追溯到网站的源服务器将内容拉取到本地。

## cdn与dns整体流程
1. 浏览器去自身dns查找
2. 去操作系统电脑查找host
3. 请求本地域名服务器（域名提供商），发现有过配置CNMAE记录www.baidu.com -> www.cdn.baidu.com，所以此时告诉浏览器转而请求cdn.baidu.com，重复1-2步骤
4. 请求本地域名服务器，发现域名提供商有进行过配置：a记录： cdn.baidu.com -> 222.222.212.222，就把这个ip地址返回给浏览器
5. 浏览器得到这个ip地址，实际上是cdn负载均衡的地址，继续请求这个地址。
6. 请求进入cdn负载均衡服务器后，服务器返回一个文件缓存服务器地址。
7. 浏览器访问文件缓存服务器IP地址，最后得到资源。

[DNS和CDN整体流程的总结](https://juejin.im/post/6854573212425814030)
[面向前端的 CDN 原理介绍](https://juejin.im/entry/6844903460828086285)